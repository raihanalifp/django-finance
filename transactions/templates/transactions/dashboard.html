{% extends "base.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}

<h2 class="text-2xl font-bold mb-6 text-gray-800">
    Dashboard Keuangan
</h2>

<form method="get" class="mb-6 flex gap-4 items-end">

    <div>
        <label class="block text-sm mb-1">From</label>
        <input type="date" name="from_date"
               value="{{ from_date }}"
               class="border rounded-lg px-3 py-2">
    </div>

    <div>
        <label class="block text-sm mb-1">To</label>
        <input type="date" name="to_date"
               value="{{ to_date }}"
               class="border rounded-lg px-3 py-2">
    </div>

    <button class="bg-blue-600 text-white px-4 py-2 rounded-lg">
        Filter
    </button>

</form>


<div class="grid grid-cols-1 md:grid-cols-3 gap-6">

    <div class="bg-white shadow-lg rounded-2xl p-6">
        <p class="text-sm text-gray-500">Total Income</p>
        <h3 class="text-2xl font-bold text-green-600 mt-2">
            Rp {{ total_income }}
        </h3>
    </div>

    <div class="bg-white shadow-lg rounded-2xl p-6">
        <p class="text-sm text-gray-500">Total Expense</p>
        <h3 class="text-2xl font-bold text-red-600 mt-2">
            Rp {{ total_expense }}
        </h3>
    </div>

    <div class="bg-white shadow-lg rounded-2xl p-6">
        <p class="text-sm text-gray-500">Balance</p>
        <h3 class="text-2xl font-bold text-blue-600 mt-2">
            Rp {{ balance }}
        </h3>
    </div>

</div>

<div class="bg-white rounded-2xl shadow-lg p-6 mt-8">
    <h3 class="text-lg font-bold mb-4">Grafik Pengeluaran</h3>
    <canvas id="expenseChart" height="120"></canvas>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const labels = JSON.parse('{{ chart_labels_json|escapejs }}');
const data = JSON.parse('{{ chart_data_json|escapejs }}');
const colors = JSON.parse('{{ background_colors_json|escapejs }}');
const tooltipDetails = JSON.parse('{{ tooltip_details_json|escapejs }}');

const ctx = document.getElementById('expenseChart');

new Chart(ctx, {
    type: 'bar',
    data: {
        labels: labels,
        datasets: [{
            label: 'Pengeluaran Harian',
            data: data,
            backgroundColor: colors,
            borderRadius: 6,
            minBarLength: 2
        }]
    },
    options: {
        responsive: true,
        plugins: {
            tooltip: {
                callbacks: {
                    afterLabel: function(context) {
                        return tooltipDetails[context.dataIndex];
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
</script>

<div class="mt-5">
    <a href="{% url 'add_transaction' %}"
        class="bg-blue-600 text-white px-4 py-2 rounded-lg">
        + Tambah Transaksi
    </a>
</div>

<div class="bg-white rounded-2xl shadow-lg p-6 mt-8">
    <h3 class="text-lg font-bold mb-4">Daftar Transaksi</h3>

    <table class="w-full text-left">
        <thead>
            <tr class="border-b">
                <th class="py-2">Tanggal</th>
                <th>Kategori</th>
                <th>Deskripsi</th>
                <th>Jumlah</th>
            </tr>
        </thead>
        <tbody>
            {% for t in transactions %}
            <tr class="border-b hover:bg-gray-50">
                <td class="py-2">{{ t.date }}</td>
                <td>{{ t.category.name }}</td>
                <td>{{ t.description }}</td>
                <td class="font-semibold">
                    Rp {{ t.amount }}
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="4" class="text-center py-4 text-gray-500">
                    Belum ada transaksi
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


{% endblock %}
